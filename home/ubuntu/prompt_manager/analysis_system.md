# プロンプト分析システムの設計と実装

## 1. 分析システムの概要

プロンプト分析システムは、ユーザーが保存したChatGPTプロンプトを分析し、改善のためのフィードバックを提供する機能です。このシステムは以下の要素で構成されています：

1. **分析用メタプロンプトの設計**
   - 保存されたプロンプトを分析するためのテンプレート
   - カスタマイズ可能なパラメータ

2. **分析プロセス**
   - 分析対象プロンプトの選択
   - メタプロンプトの生成
   - ChatGPTへの送信方法

3. **フィードバック表示**
   - 分析結果の整理と表示
   - フィードバックの保存

## 2. 分析用メタプロンプトの設計

### 基本テンプレート

```
以下のプロンプトを分析し、改善点を提案してください。より効果的なプロンプトにするためのアドバイスを具体的に示してください。

プロンプト:
{{prompt}}
```

### 拡張テンプレート（詳細分析用）

```
以下のプロンプトを詳細に分析し、改善のためのフィードバックを提供してください。

【分析対象プロンプト】
{{prompt}}

【分析観点】
1. 明確さ: プロンプトの指示は明確で具体的か
2. 構造: プロンプトの構造は適切か
3. 文脈: 必要な文脈情報が含まれているか
4. 制約条件: 適切な制約や条件が設定されているか
5. 出力形式: 期待する出力形式が明示されているか

【改善提案】
上記の観点から、プロンプトの改善点を具体的に提案してください。

【最適化バージョン】
分析を踏まえて最適化されたプロンプトの例を提示してください。
```

## 3. 分析プロセスの実装

プロンプト分析システムは、プロンプト管理ページ内の「プロンプト分析」タブに実装されています。主な機能は以下の通りです：

1. **分析対象の選択**
   - 最新の1件、5件、10件、またはすべてのプロンプトを選択可能
   - 特定のカテゴリやタグでフィルタリングも可能（将来の拡張機能）

2. **メタプロンプトのカスタマイズ**
   - ユーザーが分析用メタプロンプトをカスタマイズ可能
   - プレースホルダー `{{prompt}}` が実際のプロンプトに置き換えられる

3. **分析の実行**
   - 「分析を開始」ボタンをクリックすると、選択したプロンプトに対して分析用メタプロンプトが生成される
   - 生成されたメタプロンプトをChatGPTに貼り付けて分析を実行

## 4. フィードバック管理

分析結果のフィードバックは以下のように管理されます：

1. **フィードバックの取得**
   - ChatGPTから得られた分析結果をコピーして、プロンプト管理システムに戻る
   - 「フィードバックを保存」機能で分析結果を対応するプロンプトに関連付ける（将来の拡張機能）

2. **フィードバックの表示**
   - プロンプト詳細画面でフィードバックを表示
   - フィードバックに基づいて改善されたプロンプトを作成可能

3. **フィードバックの活用**
   - 過去のフィードバックを参考に、新しいプロンプトの作成や既存プロンプトの改善に活用
   - フィードバックの傾向分析による、プロンプト作成スキルの向上（将来の拡張機能）

## 5. 将来の拡張計画

現在の実装は基本的な分析機能を提供していますが、将来的には以下の拡張が考えられます：

1. **自動フィードバック保存**
   - ChatGPTのAPIが利用可能になった場合、自動的に分析を実行しフィードバックを保存

2. **フィードバック統計**
   - 複数のプロンプトに対するフィードバックから共通の改善点を抽出
   - ユーザーのプロンプト作成パターンの分析

3. **プロンプトテンプレート生成**
   - 分析結果に基づいた効果的なプロンプトテンプレートの自動生成
   - ユーザー固有のプロンプトスタイルに合わせたカスタマイズ

4. **協調学習機能**
   - 複数ユーザー間でのプロンプトとフィードバックの共有（プライバシーに配慮）
   - コミュニティベースの改善提案

## 6. 技術的実装詳細

現在の実装では、分析システムは以下のJavaScript関数で実現されています：

```javascript
// プロンプトの分析
function analyzePrompts() {
    const prompts = getPrompts();
    if (prompts.length === 0) {
        showNotification('分析するプロンプトがありません', false);
        return;
    }
    
    const count = document.getElementById('analysis-count').value;
    const metaPrompt = document.getElementById('analysis-prompt').value;
    
    let promptsToAnalyze = [];
    if (count === 'all') {
        promptsToAnalyze = [...prompts];
    } else {
        const numCount = parseInt(count);
        promptsToAnalyze = prompts.slice(0, numCount);
    }
    
    if (promptsToAnalyze.length === 0) {
        showNotification('分析するプロンプトがありません', false);
        return;
    }
    
    // 分析結果の表示
    feedbackContainer.innerHTML = '<p>分析を開始します。ChatGPTを開いて、以下のプロンプトを入力してください：</p>';
    
    promptsToAnalyze.forEach((prompt, index) => {
        const analysisPrompt = metaPrompt.replace('{{prompt}}', prompt.prompt);
        
        const feedbackDiv = document.createElement('div');
        feedbackDiv.className = 'feedback-item';
        feedbackDiv.innerHTML = `
            <div class="feedback-title">プロンプト ${index + 1}</div>
            <div class="feedback-content">${analysisPrompt}</div>
        `;
        
        feedbackContainer.appendChild(feedbackDiv);
    });
    
    showNotification('分析用プロンプトを生成しました', true);
}
```

この実装により、APIを使わずにブラウザ上でプロンプト分析システムを実現しています。
